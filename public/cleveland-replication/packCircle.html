<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Pack Layout without Outer Circle</title>
    <script src="https://d3js.org/d3.v7.js"></script>
    <script src="../js/revisit-communicate.js"></script>
</head>
<body>
    <svg></svg>
    <script>
        const svg = d3.select("svg")
                      .attr("viewBox", "0 0 800 800") 
                      .append("g")
                      .attr("transform", "translate(400,400)"); 
        Revisit.onDataReceive((parameters) => {
            console.log(parameters);

            parameters.data.forEach(d => {
                d.value = +d.value;
            });

            const drawPack = (data, selectedIndices) => {
                const pack = d3.pack()
                    .size([800 - 4, 800 - 4]) // Adjust size as needed
                    .padding(5);

                const root = d3.hierarchy({children: data})
                    .sum(d => d.value);

                const nodes = pack(root).descendants().slice(1); // Skip the root node to remove the outer circle

                svg.selectAll("circle")
                    .data(nodes)
                    .join("circle")
                    .attr("cx", d => d.x - 400) // Adjusted for centered positioning within viewBox
                    .attr("cy", d => d.y - 400) // Adjusted for centered positioning within viewBox
                    .attr("r", d => d.r)
                    .style("fill", d => d.children ? "#fff" : "#69b3a2")
                    .attr("stroke", "black");

                svg.selectAll(".selected")
                    .data(nodes.filter((_, i) => selectedIndices.includes(i + 1))) // Adjust index for filtering
                    .join("circle")
                    .attr("class", "selected")
                    .attr("cx", d => d.x - 400)
                    .attr("cy", d => d.y - 400)
                    .attr("r", 5)
                    .style("fill", "black");
            };

            drawPack(parameters.data, parameters.selectedIndices);
        });
    </script>
</body>
</html>
